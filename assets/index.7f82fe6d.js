import{_ as $e}from"./index.ade04a53.js";/* empty css               *//* empty css              *//* empty css               *//* empty css               */import{a as xe,p as Ce}from"./index.815b9338.js";import{b as J,f as K,g as A,n as j,j as D,k as F,u as k}from"./walletProvider.da6d7796.js";/* empty css               *//* empty css               *//* empty css               */import{d as je,r as V,c as Ne,o as Ie,b as Se,aK as N,B as p,C as x,aH as a,aG as t,F as h,u as s,aD as v,bd as W,aM as g,aN as d,E as X,aJ as I,aI as z,aE as G,be as Te,bf as Ue,bg as Ee,bh as Be,b9 as Fe,b8 as Ve,bc as Me,bi as Re,bj as Ae,ba as De,b2 as ze,bk as Ge,aX as Le,b3 as Oe,bl as Pe,bm as qe,bn as He,bo as Je,b6 as Ke,b7 as We,bp as Xe,a_ as Qe,bq as Ye,aR as L}from"./arco.80c7dde8.js";import{i as Q}from"./index.b46115d6.js";import"./chart.b84c2f99.js";import"./vue.16fab11f.js";const Y=[{amount:1e4,nft:0},{amount:2e4,nft:0},{amount:3e4,nft:0},{amount:4e4,nft:0},{amount:5e4,nft:1},{amount:7e4,nft:2},{amount:1e5,nft:4}];const Z=S=>(Te("data-v-afea387a"),S=S(),Ue(),S),Ze={style:{padding:"1rem"}},et={class:"nft-footer"},tt=Z(()=>h("br",null,null,-1)),at={class:"nft-footer"},nt={class:"nft-footer"},ot=Z(()=>h("br",null,null,-1)),st={class:"nft-footer"},it=g(" +1 "),lt=je({setup(S){const ee=e=>Y[e].amount,M=e=>Y[e].nft,w=V({item:{},visible:!1,loading:!1,address:""}),f=V({item:{grade:0},nfts:[],approve:!1,visible:!1,loading:!1,balance:0}),u=V({item:{},loading:void 0}),b=V({loading:!1,total:0,items:[]}),te=Ne(()=>b.items.filter(e=>e.grade===0)),T=async(e,o)=>{const i=await fetch(o).then(r=>r.json()),n={token:e,name:`${i.name}`,image:`${i.image}`};if(i.attributes){const r=i.attributes.find(_=>_.trait_type==="Score");r&&(n.score=Number(r.value));const m=i.attributes.find(_=>_.trait_type==="Grade");m&&(n.grade=Number(m.value))}return n},ae=async()=>{const e=k();if(e){b.loading=!0;const o=D.connect(j,e),i=await e.getAddress();let n=[],r=0,m=0;const _=10;do{const{rows:c}=await o.tokenOfOwnerList(i,m,_),y=await o.tokenURIList(c);n=[...n,...y.map((U,$)=>({token:c[$].toNumber(),loading:!0,uri:U}))],r=c.length,m+=_}while(r>0);b.total=n.length,b.items=n,b.loading=!1,b.items.forEach(c=>{c.loading=!1,T(c.token,c.uri).then(y=>{c.name=y.name,c.grade=y.grade,c.image=y.image,c.score=y.score}).catch(()=>{c.name="..",c.grade=0,c.image="",c.score=0})})}},ne=async e=>{const o=k();if(o){const i=D.connect(j,o);let n="",r=0;do{if(n=await i.tokenURI(e.token),console.log(n),n.endsWith("goldbox.json"))await new Promise(m=>{setTimeout(()=>{m()},3e3)});else{const m=await T(e.token,n);e.image=m.image,e.name=m.name,e.score=m.score}r+=1}while(n.includes("goldbox")&&r<10)}},oe=async e=>{const o=k();if(o){e.loading=!0;try{await(await D.connect(j,o).openGoldBox(e.token)).wait(),await ne(e)}catch(i){const{error:n,message:r}=i;L.warning(n?n.data.message:r)}e.loading=!1}},se=async e=>{if(k()){u.loading=!0;const i=F();try{const n=await i.ownerOf(e),r=await i.tokenURI(e);console.log(n,r);const m={token:Number(e),uri:r,loading:!1,owner:`${n.substring(0,6)}....${n.substring(38)}`};T(m.token,m.uri).then(_=>{u.item.name=_.name,u.item.grade=_.grade,u.item.image=_.image,u.item.score=_.score,u.loading=!1}),u.item=m}catch{L.warning("NFT \u4E0D\u5B58\u5728"),u.loading=void 0}}},ie=async e=>{if(k())try{const o=A(),i=await o.signer.getAddress();o.balanceOf(i).then(n=>{f.balance=Number(xe(n))})}catch(o){console.log(o)}f.nfts=[],f.item=e,f.visible=!0},le=async()=>{if(k())try{await(await A().approve(j,Ce("10000000000"))).wait()}catch(e){console.log(e)}},re=async e=>{if(k())try{const i=await F().tokenURI(e.token);e.uri=i,await T(e.token,i).then(n=>{e.name=n.name,e.grade=n.grade,e.image=n.image,e.score=n.score})}catch{console.log(12)}},ce=async e=>{const{item:o}=f;if(k())try{await(await F().upgradeGold(o.token,f.nfts.map(r=>r.token))).wait(),await re(o),e(!0),f.nfts.forEach(r=>{b.items.splice(b.items.findIndex(m=>m.token===r.token),1)})}catch(i){const{error:n,message:r}=i;L.warning(n?n.data.message:r),e(!1)}},de=async e=>{const{item:o}=w;if(k())try{const i=F(),n=await i.signer.getAddress();await(await i.transferFrom(n,w.address,o.token)).wait(),e(!0)}catch{console.log(233),e(!1)}},R=async()=>{const e=A(),o=e.signer.getAddress();e.allowance(o,j).then(i=>{f.approve=!i.eq("0")}),ae()},O=()=>{b.items=[],b.total=0};return Ie(()=>{J.on(R),K.on(O),k()&&R()}),Se(()=>{J.off(R),K.off(O)}),(e,o)=>{const i=Ee,n=Be,r=Fe,m=Ve,_=N("icon-more"),c=Me,y=Re,U=Ae,$=De,P=ze,fe=Ge,me=N("icon-thunderbolt"),E=Le,ue=N("icon-bar-chart"),pe=N("icon-share-internal"),q=Oe,ge=Pe,_e=qe,C=He,be=N("icon-arrow-rise"),he=Je,ke=Ke,ye=We,ve=Xe,H=Qe,we=Ye;return p(),x("div",Ze,[a(q,null,{default:t(()=>[h("div",{style:X({flex:s(Q)?"0 0 270px":"",paddingRight:"20px"})},[a(c,{title:e.$t("nft.validata")},{default:t(()=>[a($,{direction:"vertical",fill:""},{default:t(()=>[a(i,{placeholder:"tokenId",loading:s(u).loading,"search-button":"",onSearch:se},null,8,["loading"]),h("div",null,[s(u).loading!==!1?(p(),v(c,{key:0,style:{"border-radius":"0.5rem"},"body-style":{padding:0},hoverable:""},{cover:t(()=>[a(r,{animation:""},{default:t(()=>[a(n,{class:"skeleton-image"})]),_:1})]),default:t(()=>[a(r,{style:{width:"80%",padding:"0.5rem"},animation:""},{default:t(()=>[a(m,{rows:2,"line-height":18})]),_:1}),h("div",et,[a(_,{style:{width:"20px",height:"20px",float:"right",margin:"6px"}})])]),_:1})):(p(),v(c,{key:1,style:{"border-radius":"0.5rem"},"body-style":{padding:0},hoverable:""},{cover:t(()=>[h("div",null,[a(y,{src:s(u).item.image,width:"100%",height:"100%",class:"nft-image"},null,8,["src"])])]),default:t(()=>[a(U,{title:`${s(u).item.name}  #${s(u).item.token}`,style:{padding:"0.5rem",height:"75px"}},W({_:2},[s(u).item.score?{name:"description",fn:t(()=>[g(d(e.$t("nft.grade"))+" : "+d(s(u).item.grade)+" ",1),tt,g(" "+d(e.$t("nft.score"))+" : "+d(s(u).item.score),1)])}:void 0]),1032,["title"]),h("div",at,[a($,null,{default:t(()=>[g(d(s(u).item.owner),1)]),_:1})])]),_:1}))])]),_:1})]),_:1},8,["title"])],4),a(_e,{style:X({flex:s(Q)?"1":""}),"default-active-key":"1"},{default:t(()=>[a(ge,{key:"1",title:e.$t("nft.mynft")},{default:t(()=>[a(q,{gutter:[10,10]},{default:t(()=>[s(b).loading?(p(),x(I,{key:0},z(4,(l,B)=>a(P,{key:B,xs:12,lg:6,xl:4},{default:t(()=>[a(c,{style:{"border-radius":"0.5rem"},"body-style":{padding:0},hoverable:""},{cover:t(()=>[a(r,{animation:""},{default:t(()=>[a(n,{class:"skeleton-image"})]),_:1})]),default:t(()=>[a(r,{style:{width:"80%",padding:"0.5rem"},animation:""},{default:t(()=>[a(m,{rows:2,"line-height":18})]),_:1}),h("div",nt,[a(_,{style:{width:"20px",height:"20px",float:"right",margin:"6px"}})])]),_:1})]),_:2},1024)),64)):(p(),x(I,{key:1},[s(b).items.length==0?(p(),v(fe,{key:0})):(p(!0),x(I,{key:1},z(s(b).items,l=>(p(),v(P,{key:l.token,xs:12,lg:6,xl:4},{default:t(()=>[a(c,{style:{"border-radius":"0.5rem"},"body-style":{padding:0},hoverable:""},{cover:t(()=>[h("div",null,[a(y,{src:l.image,width:"100%",height:"100%",class:"nft-image"},null,8,["src"])])]),default:t(()=>[a(U,{title:`${l.name}  #${l.token}`,style:{padding:"0.5rem",height:"65px"}},W({_:2},[l.score?{name:"description",fn:t(()=>[g(d(e.$t("nft.grade"))+" : "+d(l.grade)+" ",1),ot,g(" "+d(e.$t("nft.score"))+" : "+d(l.score),1)])}:void 0]),1032,["title"]),h("div",st,[a($,null,{default:t(()=>[l.name==="Gold Box"?(p(),v(E,{key:0,type:"primary",size:"small",status:"success",loading:l.loading,onClick:B=>oe(l)},{icon:t(()=>[a(me)]),default:t(()=>[g(" "+d(e.$t("nft.open")),1)]),_:2},1032,["loading","onClick"])):(p(),x(I,{key:1},[l.grade!==7?(p(),v(E,{key:0,size:"small",onClick:B=>ie(l)},{icon:t(()=>[a(ue)]),default:t(()=>[g(" "+d(e.$t("nft.upgrade")),1)]),_:2},1032,["onClick"])):G("",!0),a(E,{size:"small",onClick:B=>{s(w).item=l,s(w).visible=!0}},{icon:t(()=>[a(pe)]),default:t(()=>[g(" "+d(e.$t("nft.transfer")),1)]),_:2},1032,["onClick"])],64))]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))],64))]),_:1})]),_:1},8,["title"])]),_:1},8,["style"])]),_:1}),a(H,{visible:s(f).visible,"onUpdate:visible":o[1]||(o[1]=l=>s(f).visible=l),"mask-closable":!1,title:e.$t("nft.upgrade"),width:"370px","modal-class":"upgrade-modal","on-before-ok":ce},{default:t(()=>[a(ve,{title:e.$t("nft.consume"),column:1},{default:t(()=>[a(C,{label:e.$t("recharge.balance")},{default:t(()=>[g(d(s(f).balance),1)]),_:1},8,["label"]),a(C,{label:"ID"},{default:t(()=>[g(" # "+d(s(f).item.token),1)]),_:1}),a(C,{label:e.$t("nft.grade")},{default:t(()=>[g(d(s(f).item.grade)+" ",1),a(he,{color:"green"},{icon:t(()=>[a(be)]),default:t(()=>[it]),_:1})]),_:1},8,["label"]),a(C,{label:e.$t("nft.roemp")},{default:t(()=>[a($,null,{default:t(()=>[g(d(ee(s(f).item.grade))+" ",1),s(f).approve?G("",!0):(p(),v(E,{key:0,type:"primary",size:"small",onClick:le},{default:t(()=>[g(d(e.$t("recharge.approve")),1)]),_:1}))]),_:1})]),_:1},8,["label"]),M(s(f).item.grade)>0?(p(),v(C,{key:0,label:e.$t("nft.NFT")},{default:t(()=>[a($,null,{default:t(()=>[a(ye,{modelValue:s(f).nfts,"onUpdate:modelValue":o[0]||(o[0]=l=>s(f).nfts=l),placeholder:`select ${M(s(f).item.grade)} nfs`,style:{width:"270px"},"value-key":"token",limit:M(s(f).item.grade),multiple:""},{label:t(({data:{value:l}})=>[h("span",null,d(l.name)+" #"+d(l.token),1)]),default:t(()=>[(p(!0),x(I,null,z(s(te),l=>(p(),v(ke,{key:l.token,value:l},{default:t(()=>[g(d(l.name)+" #"+d(l.token),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","placeholder","limit"])]),_:1})]),_:1},8,["label"])):G("",!0)]),_:1},8,["title"])]),_:1},8,["visible","title","on-before-ok"]),a(H,{visible:s(w).visible,"onUpdate:visible":o[3]||(o[3]=l=>s(w).visible=l),"align-center":!1,width:360,top:100,title:e.$t("nft.transfer"),"on-before-ok":de},{default:t(()=>[a(we,{modelValue:s(w).address,"onUpdate:modelValue":o[2]||(o[2]=l=>s(w).address=l)},null,8,["modelValue"])]),_:1},8,["visible","title","on-before-ok"])])}}});var wt=$e(lt,[["__scopeId","data-v-afea387a"]]);export{wt as default};
