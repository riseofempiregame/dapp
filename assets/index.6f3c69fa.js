import{_ as G,u as F,i as K}from"./index.f71c2c63.js";/* empty css               *//* empty css               *//* empty css               *//* empty css              */import{b as $,g as W,u as f,a as j,c as X,p as Y,d as q}from"./walletProvider.20621f46.js";/* empty css              */import{d as J,e as V,r as I,aY as O,o as Q,b as ee,aK as x,aZ as te,B as r,C as N,aH as c,aG as n,u as i,aD as l,F as T,a_ as se,D as ae,aE as d,aM as u,aN as g,n as ne,aR as v,a$ as oe,b0 as ie,b1 as re,b2 as le,b3 as ce,aX as de,b4 as pe,aW as ue,b5 as ge,b6 as me}from"./arco.8464fde2.js";/* empty css               */import{g as _e}from"./vue.012b1438.js";import"./chart.fc3d73b6.js";const fe={class:"game-box"},ve=J({setup(be){const{t:b}=F(),C=V(null),p=I({state:0}),m=V(!1);_e("message",({data:{action:e,status:s}})=>{if(e){switch(e){case"game_status":p.state=0,O.warning({content:b("enter.logoutmsg"),title:b("enter.tips")});break}console.log(e,s)}});const t=I({isAdmin:!1,address:"",loading:!1,isPledge:!1,pledgeTime:0,approve:!1}),B=async()=>{const e=await W(t.isAdmin?t.address:void 0);if(console.log(e),e){p.state=1;const a=`https://cdn.riseofempire.io/${K.global.locale==="zh-CN"?"zh/":""}?timestamp=${e.timestamp}&address=${e.account}&sign=${e.sign}&version=1.3`;ne(()=>{C.value.src=a})}else v.warning(b("pleaseconnect"))},M=async()=>{const e=f();if(e){t.loading=!0;try{await(await e.userPledge()).wait(),t.isPledge=!0,t.pledgeTime=new Date().getTime()}catch(s){const{error:a,message:o}=s;v.warning(a?a.data.message:o)}t.loading=!1}},A=async()=>{const e=f();if(e){t.loading=!0;try{await(await e.userUnPledge()).wait(),t.isPledge=!1,t.pledgeTime=0}catch(s){const{error:a,message:o}=s;v.warning(a?a.data.message:o)}t.loading=!1}},D=async()=>{const e=f(),s=j();if(s){t.loading=!0;try{await(await s.approve(e.address,X)).wait(),t.approve=!0}catch(a){const{error:o,message:k}=a;v.warning(o?o.data.message:k)}t.loading=!1}},y=async()=>{p.state=0;const e=f(),s=j(),a=await e.signer.getAddress();s.allowance(a,e.address).then(o=>{t.approve=o.gt(Y("10000"))}),e.pledgeTime(a).then(o=>{t.isPledge=o.toNumber()>0,t.pledgeTime=o.toNumber()/1e3}),e.hasRole("0xa49807205ce4d355092ef5a8a18f56e8913cf4a201fbe287825b095693c21775",a).then(o=>{t.isAdmin=o})};return Q(()=>{$.on(y),q()&&y()}),ee(()=>{$.off(y)}),(e,s)=>{const a=x("IconClose"),o=x("icon-home"),k=x("IconImport"),z=oe,E=ie,U=re,P=le,R=ce,w=de,S=pe,h=ue,H=ge,L=me,Z=te("drag");return r(),N("div",null,[c(L,{justify:"center"},{default:n(()=>[i(p).state==1?(r(),l(P,{key:0},{default:n(()=>[T("div",fe,[T("iframe",{ref_key:"elifame",ref:C,class:"game-iframe"},null,512)]),c(U,{popupVisible:m.value,"onUpdate:popupVisible":s[1]||(s[1]=_=>m.value=_),style:{"z-index":"99999999"},trigger:["click","hover"],"click-to-close":"",position:"top"},{content:n(()=>[c(E,{style:{marginBottom:"-4px"},mode:"popButton","tooltip-props":{position:"left"},"show-collapse-button":"",onMenuItemClick:s[0]||(s[0]=_=>{i(p).state=0,m.value=!1})},{default:n(()=>[c(z,{key:"1"},{icon:n(()=>[c(k)]),_:1})]),_:1})]),default:n(()=>[se((r(),N("div",{class:ae(`button-trigger ${m.value?"button-trigger-active":""}`)},[m.value?(r(),l(a,{key:0})):(r(),l(o,{key:1}))],2)),[[Z]])]),_:1},8,["popupVisible"])]),_:1})):d("",!0),i(p).state==0?(r(),l(P,{key:1,flex:"300px",style:{"padding-top":"2rem"}},{default:n(()=>[i(t).isAdmin?(r(),l(R,{key:0,modelValue:i(t).address,"onUpdate:modelValue":s[2]||(s[2]=_=>i(t).address=_)},null,8,["modelValue"])):d("",!0),i(t).isPledge?d("",!0):(r(),l(h,{key:1,status:"warning",title:e.$t("enter.Pledge.warning.title")},{subtitle:n(()=>[u(g(e.$t("enter.Pledge.warning.message")),1)]),extra:n(()=>[c(S,null,{default:n(()=>[i(t).approve?d("",!0):(r(),l(w,{key:0,type:"primary",loading:i(t).loading,onClick:D},{default:n(()=>[u(g(e.$t("recharge.approve")),1)]),_:1},8,["loading"])),c(w,{type:"primary",loading:i(t).loading,disabled:!i(t).approve,onClick:M},{default:n(()=>[u(g(e.$t("enter.Pledge.buyPledge")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["title"])),i(t).isPledge?(r(),l(h,{key:2,status:"success",title:e.$t("enter.Pledge.success.title")},{subtitle:n(()=>[u(g(e.$t("enter.Pledge.success.message"))+" ",1),c(H,{status:"danger",disabled:i(t).loading,onClick:A},{default:n(()=>[u(g(e.$t("enter.Pledge.outPledge")),1)]),_:1},8,["disabled"])]),extra:n(()=>[]),_:1},8,["title"])):d("",!0),i(t).isPledge?(r(),l(w,{key:3,class:"game-enterbtn",long:"",size:"large",type:"primary",status:"success",onClick:B},{default:n(()=>[u(g(e.$t("menu.enter")),1)]),_:1})):d("",!0)]),_:1})):d("",!0)]),_:1})])}}});var Ne=G(ve,[["__scopeId","data-v-3ecce6f8"]]);export{Ne as default};
