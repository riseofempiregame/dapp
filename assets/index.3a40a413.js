import{_ as G,u as J,i as K}from"./index.e318090a.js";/* empty css               */import{b as j,g as W,u as f,a as V,c as X,p as Y,d as q}from"./walletProvider.17d54f8e.js";/* empty css               *//* empty css               *//* empty css              *//* empty css              */import{d as O,e as I,r as N,aY as Q,o as ee,b as te,aK as x,aZ as se,B as r,C,aH as d,aG as n,u as i,aJ as ae,aD as l,F as T,a_ as ne,D as oe,aE as p,aM as g,aN as u,n as ie,aR as v,a$ as re,b0 as le,b1 as ce,b2 as de,b3 as pe,aX as ge,b4 as ue,aW as me,b5 as _e,b6 as fe,b7 as ve}from"./arco.c7340238.js";/* empty css               */import{g as ye}from"./vue.eb34ecf5.js";import"./chart.302af132.js";const be={class:"game-box"},ke=O({setup(we){const{t:y}=J(),P=I(null),c=N({connected:!1,state:0}),m=I(!1);ye("message",({data:{action:e,status:s}})=>{if(e){switch(e){case"game_status":c.state=0,Q.warning({content:y("enter.logoutmsg"),title:y("enter.tips")});break}console.log(e,s)}});const t=N({isAdmin:!1,address:"",loading:!1,isPledge:!1,pledgeTime:0,approve:!1}),B=async()=>{const e=await W(t.isAdmin?t.address:void 0);if(console.log(e),e){c.state=1;const a=`https://cdn.riseofempire.io/${K.global.locale==="zh-CN"?"zh/":""}?timestamp=${e.timestamp}&address=${e.account}&sign=${e.sign}&version=1.3`;ie(()=>{P.value.src=a})}else v.warning(y("pleaseconnect"))},M=async()=>{const e=f();if(e){t.loading=!0;try{await(await e.userPledge()).wait(),t.isPledge=!0,t.pledgeTime=new Date().getTime()}catch(s){const{error:a,message:o}=s;v.warning(a?a.data.message:o)}t.loading=!1}},A=async()=>{const e=f();if(e){t.loading=!0;try{await(await e.userUnPledge()).wait(),t.isPledge=!1,t.pledgeTime=0}catch(s){const{error:a,message:o}=s;v.warning(a?a.data.message:o)}t.loading=!1}},D=async()=>{const e=f(),s=V();if(s){t.loading=!0;try{await(await s.approve(e.address,X)).wait(),t.approve=!0}catch(a){const{error:o,message:k}=a;v.warning(o?o.data.message:k)}t.loading=!1}},b=async()=>{c.state=0;const e=f(),s=V(),a=await e.signer.getAddress();s.allowance(a,e.address).then(o=>{t.approve=o.gt(Y("10000"))}),e.pledgeTime(a).then(o=>{t.isPledge=o.toNumber()>0,t.pledgeTime=o.toNumber()/1e3,c.connected=!0}),e.hasRole("0xa49807205ce4d355092ef5a8a18f56e8913cf4a201fbe287825b095693c21775",a).then(o=>{t.isAdmin=o})};return ee(()=>{j.on(b),q()&&b()}),te(()=>{j.off(b),c.connected=!1}),(e,s)=>{const a=x("IconClose"),o=x("icon-home"),k=x("IconImport"),z=re,E=le,S=ce,h=de,U=pe,w=ge,R=ue,$=me,H=_e,L=fe,Z=ve,F=se("drag");return r(),C("div",null,[d(Z,{justify:"center"},{default:n(()=>[i(c).connected?(r(),C(ae,{key:0},[i(c).state==1?(r(),l(h,{key:0},{default:n(()=>[T("div",be,[T("iframe",{ref_key:"elifame",ref:P,class:"game-iframe"},null,512)]),d(S,{popupVisible:m.value,"onUpdate:popupVisible":s[1]||(s[1]=_=>m.value=_),style:{"z-index":"99999999"},trigger:["click","hover"],"click-to-close":"",position:"top"},{content:n(()=>[d(E,{style:{marginBottom:"-4px"},mode:"popButton","tooltip-props":{position:"left"},"show-collapse-button":"",onMenuItemClick:s[0]||(s[0]=_=>{i(c).state=0,m.value=!1})},{default:n(()=>[d(z,{key:"1"},{icon:n(()=>[d(k)]),_:1})]),_:1})]),default:n(()=>[ne((r(),C("div",{class:oe(`button-trigger ${m.value?"button-trigger-active":""}`)},[m.value?(r(),l(a,{key:0})):(r(),l(o,{key:1}))],2)),[[F]])]),_:1},8,["popupVisible"])]),_:1})):p("",!0),i(c).state==0?(r(),l(h,{key:1,flex:"300px",style:{"padding-top":"2rem"}},{default:n(()=>[i(t).isAdmin?(r(),l(U,{key:0,modelValue:i(t).address,"onUpdate:modelValue":s[2]||(s[2]=_=>i(t).address=_)},null,8,["modelValue"])):p("",!0),i(t).isPledge?p("",!0):(r(),l($,{key:1,status:"warning",title:e.$t("enter.Pledge.warning.title")},{subtitle:n(()=>[g(u(e.$t("enter.Pledge.warning.message")),1)]),extra:n(()=>[d(R,null,{default:n(()=>[i(t).approve?p("",!0):(r(),l(w,{key:0,type:"primary",loading:i(t).loading,onClick:D},{default:n(()=>[g(u(e.$t("recharge.approve")),1)]),_:1},8,["loading"])),d(w,{type:"primary",loading:i(t).loading,disabled:!i(t).approve,onClick:M},{default:n(()=>[g(u(e.$t("enter.Pledge.buyPledge")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["title"])),i(t).isPledge?(r(),l($,{key:2,status:"success",title:e.$t("enter.Pledge.success.title")},{subtitle:n(()=>[g(u(e.$t("enter.Pledge.success.message"))+" ",1),d(H,{status:"danger",disabled:i(t).loading,onClick:A},{default:n(()=>[g(u(e.$t("enter.Pledge.outPledge")),1)]),_:1},8,["disabled"])]),extra:n(()=>[]),_:1},8,["title"])):p("",!0),i(t).isPledge?(r(),l(w,{key:3,class:"game-enterbtn",long:"",size:"large",type:"primary",status:"success",onClick:B},{default:n(()=>[g(u(e.$t("menu.enter")),1)]),_:1})):p("",!0)]),_:1})):p("",!0)],64)):(r(),l(L,{key:1,dot:"",style:{"margin-top":"2rem"},tip:"loading.."}))]),_:1})])}}});var Me=G(ke,[["__scopeId","data-v-5a497aed"]]);export{Me as default};
