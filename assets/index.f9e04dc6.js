import{_ as Ce}from"./index.59461365.js";import{b as q,i as H,a as A,n as J,j as $,d as y,k as Ie,p as Se}from"./walletProvider.24d12886.js";/* empty css              *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css               *//* empty css               */import{d as je,r as V,c as Ne,o as Te,b as Ue,aK as I,B as p,C as S,aH as a,aG as t,E as K,u as s,F as k,aD as h,aE as j,bg as W,aM as b,aN as u,aJ as F,aI as X,bh as Ee,bi as Be,bj as Ve,bk as Fe,bd as Me,bc as ze,bf as Ae,bl as De,bm as Ge,b4 as Le,bn as Re,bo as Oe,b2 as Pe,b6 as qe,bp as He,aX as Je,b7 as Ke,bq as We,br as Xe,bs as Ye,bt as Qe,ba as Ze,bb as et,bu as tt,aY as at,b3 as nt,aR as D}from"./arco.c7340238.js";import{i as Y}from"./index.8cc4f56e.js";import"./chart.302af132.js";import"./vue.eb34ecf5.js";const Q=[{amount:1e4,nft:0},{amount:2e4,nft:0},{amount:3e4,nft:0},{amount:4e4,nft:0},{amount:5e4,nft:1},{amount:7e4,nft:2},{amount:1e5,nft:4}];const G=N=>(Ee("data-v-35cea4ca"),N=N(),Be(),N),ot={style:{padding:"0.5rem"}},st={class:"nft-footer"},it=G(()=>k("br",null,null,-1)),rt=G(()=>k("div",{style:{width:"100%",height:"20vh"}},null,-1)),lt={class:"nft-footer"},dt=G(()=>k("br",null,null,-1)),ct={class:"nft-footer"},mt=b(" +1 "),ut=je({setup(N){const Z=e=>Q[e].amount,M=e=>Q[e].nft,w=V({item:{},visible:!1,loading:!1,address:""}),c=V({item:{grade:0},nfts:[],approve:!1,visible:!1,loading:!1,balance:0}),f=V({item:{},loading:void 0}),_=V({loading:!1,total:0,items:[]}),ee=Ne(()=>_.items.filter(e=>e.grade===0)),T=async(e,o)=>{const i=await fetch(o).then(l=>l.json()),n={token:e,name:`${i.name}`,image:`${i.image}`};if(i.attributes){const l=i.attributes.find(g=>g.trait_type==="Score");l&&(n.score=Number(l.value));const m=i.attributes.find(g=>g.trait_type==="Grade");m&&(n.grade=Number(m.value))}return n},te=async()=>{const e=y();if(e){_.loading=!0;const o=$(),i=await e.getAddress();let n=[],l=0,m=0;const g=10;do{const{rows:d}=await o.tokenOfOwnerList(i,m,g),v=await o.tokenURIList(d);n=[...n,...v.map((U,x)=>({token:d[x].toNumber(),loading:!0,uri:U}))],l=d.length,m+=g}while(l>0);_.total=n.length,_.items=n,_.loading=!1,_.items.forEach(d=>{d.loading=!0,T(d.token,d.uri).then(v=>{d.name=v.name,d.grade=v.grade,d.image=v.image,d.score=v.score}).catch(()=>{d.name="..",d.grade=0,d.image="",d.score=0}).finally(()=>{d.loading=!1})})}},ae=async e=>{if(y()){const i=$();let n="",l=0;do{if(n=await i.tokenURI(e.token),n.endsWith("goldbox.json"))await new Promise(m=>{setTimeout(()=>{m()},3e3)});else{const m=await T(e.token,n);e.image=m.image,e.name=m.name,e.score=m.score}l+=1}while(n.includes("goldbox")&&l<10)}},ne=async e=>{if(y()){e.loading=!0;try{await(await $().openGoldBox(e.token)).wait(),await ae(e)}catch(i){const{error:n,message:l}=i;D.warning(n?n.data.message:l)}e.loading=!1}},oe=async e=>{if(y()){f.loading=!0;const i=$();try{const n=await i.ownerOf(e),l=await i.tokenURI(e),m={token:Number(e),uri:l,loading:!1,owner:`${n.substring(0,6)}....${n.substring(38)}`};T(m.token,m.uri).then(g=>{f.item.name=g.name,f.item.grade=g.grade,f.item.image=g.image,f.item.score=g.score,f.loading=!1}),f.item=m}catch{D.warning("NFT \u4E0D\u5B58\u5728"),f.loading=void 0}}},se=async e=>{if(y())try{const o=A(),i=await o.signer.getAddress();o.balanceOf(i).then(n=>{c.balance=Number(Ie(n))})}catch(o){console.log(o)}c.nfts=[],c.item=e,c.visible=!0},ie=async()=>{if(y())try{await(await A().approve(J,Se("10000000000"))).wait()}catch(e){console.log(e)}},re=async e=>{if(y())try{const i=await $().tokenURI(e.token);e.uri=i,await T(e.token,i).then(n=>{e.name=n.name,e.grade=n.grade,e.image=n.image,e.score=n.score})}catch(o){console.error(o)}},le=async e=>{const{item:o}=c;if(y())try{await(await $().upgradeGold(o.token,c.nfts.map(l=>l.token))).wait(),await re(o),e(!0),c.nfts.forEach(l=>{_.items.splice(_.items.findIndex(m=>m.token===l.token),1)})}catch(i){const{error:n,message:l}=i;D.warning(n?n.data.message:l),e(!1)}},de=async e=>{const{item:o}=w;if(y())try{const i=$(),n=await i.signer.getAddress();await(await i.transferFrom(n,w.address,o.token)).wait(),e(!0)}catch(i){console.error(i),e(!1)}},z=async()=>{const e=A(),o=e.signer.getAddress();e.allowance(o,J).then(i=>{c.approve=!i.eq("0")}),te()},L=()=>{_.items=[],_.total=0};return Te(()=>{q.on(z),H.on(L),y()&&z()}),Ue(()=>{q.off(z),H.off(L)}),(e,o)=>{const i=Ve,n=Fe,l=Me,m=ze,g=I("icon-more"),d=Ae,v=De,U=Ge,x=Le,ce=Re,me=Oe,E=Pe,ue=qe,fe=He,pe=I("icon-thunderbolt"),B=Je,_e=I("icon-bar-chart"),ge=I("icon-share-internal"),R=Ke,be=We,he=Xe,C=Ye,ye=I("icon-arrow-rise"),ke=Qe,ve=Ze,we=et,$e=tt,O=at,xe=nt;return p(),S("div",ot,[a(R,{gutter:[10,10]},{default:t(()=>[a(E,{style:K({flex:s(Y)?"0 0 270px":""})},{default:t(()=>[a(me,{"default-active-key":["1"]},{default:t(()=>[a(ce,{key:"1",header:e.$t("nft.validata"),class:"query-nft"},{default:t(()=>[a(x,{direction:"vertical",fill:""},{default:t(()=>[a(i,{placeholder:"tokenId",loading:s(f).loading,"search-button":"",onSearch:oe},null,8,["loading"]),k("div",null,[s(f).loading===!0?(p(),h(d,{key:0,style:{"border-radius":"0.5rem"},"body-style":{padding:0},hoverable:""},{cover:t(()=>[a(l,{animation:""},{default:t(()=>[a(n,{class:"skeleton-image"})]),_:1})]),default:t(()=>[a(l,{style:{width:"80%",padding:"0.5rem"},animation:""},{default:t(()=>[a(m,{rows:2,"line-height":18})]),_:1}),k("div",st,[a(g,{style:{width:"20px",height:"20px",margin:"1px"}})])]),_:1})):j("",!0),s(f).loading===!1?(p(),h(d,{key:1,style:{"border-radius":"0.5rem"},"body-style":{padding:0},hoverable:""},{cover:t(()=>[k("div",null,[a(v,{src:s(f).item.image,width:"100%",height:"100%",class:"nft-image"},null,8,["src"])])]),default:t(()=>[a(U,{title:`${s(f).item.name}  #${s(f).item.token}`,style:{padding:"0.5rem",height:"85px"}},W({_:2},[s(f).item.score?{name:"description",fn:t(()=>[b(u(e.$t("nft.grade"))+" : "+u(s(f).item.grade)+" ",1),it,b(" "+u(e.$t("nft.score"))+" : "+u(s(f).item.score),1)])}:void 0]),1032,["title"])]),_:1})):j("",!0)])]),_:1})]),_:1},8,["header"])]),_:1})]),_:1},8,["style"]),a(E,{style:K({flex:s(Y)?"1":""})},{default:t(()=>[a(he,null,{default:t(()=>[a(be,{key:"1",title:e.$t("nft.mynft")},{default:t(()=>[a(R,{gutter:[5,10]},{default:t(()=>[s(_).loading?(p(),h(E,{key:0,style:{"text-align":"center"}},{default:t(()=>[a(ue,{loading:s(_).loading,dot:"",tip:"loading...."},{default:t(()=>[rt]),_:1},8,["loading"])]),_:1})):(p(),S(F,{key:1},[s(_).items.length==0?(p(),h(fe,{key:0})):(p(!0),S(F,{key:1},X(s(_).items,r=>(p(),h(E,{key:r.token,xs:12,lg:6,xl:4},{default:t(()=>[r.loading?(p(),h(d,{key:0,style:{"border-radius":"0.5rem"},"body-style":{padding:0},hoverable:""},{cover:t(()=>[a(l,{animation:""},{default:t(()=>[a(n,{class:"skeleton-image"})]),_:1})]),default:t(()=>[a(l,{style:{width:"80%",padding:"0.5rem"},animation:""},{default:t(()=>[a(m,{rows:2,"line-height":18})]),_:1}),k("div",lt,[a(g,{style:{width:"20px",height:"20px",margin:"1px"}})])]),_:1})):(p(),h(d,{key:1,style:{"border-radius":"0.5rem"},"body-style":{padding:0},hoverable:""},{cover:t(()=>[k("div",null,[a(v,{src:r.image,width:"100%",height:"100%",class:"nft-image"},null,8,["src"])])]),default:t(()=>[a(U,{title:`${r.name}  #${r.token}`,style:{padding:"0.5rem",height:"65px"}},W({_:2},[r.score?{name:"description",fn:t(()=>[b(u(e.$t("nft.grade"))+" : "+u(r.grade)+" ",1),dt,b(" "+u(e.$t("nft.score"))+" : "+u(r.score),1)])}:void 0]),1032,["title"]),k("div",ct,[a(x,{size:"small"},{default:t(()=>[r.name==="Gold Box"?(p(),h(B,{key:0,type:"primary",size:"mini",status:"success",loading:r.loading,onClick:P=>ne(r)},{icon:t(()=>[a(pe)]),default:t(()=>[b(" "+u(e.$t("nft.open")),1)]),_:2},1032,["loading","onClick"])):(p(),S(F,{key:1},[r.grade!==7?(p(),h(B,{key:0,size:"mini",onClick:P=>se(r)},{icon:t(()=>[a(_e)]),default:t(()=>[b(" "+u(e.$t("nft.upgrade")),1)]),_:2},1032,["onClick"])):j("",!0),a(B,{size:"mini",onClick:P=>{s(w).item=r,s(w).visible=!0}},{icon:t(()=>[a(ge)]),default:t(()=>[b(" "+u(e.$t("nft.transfer")),1)]),_:2},1032,["onClick"])],64))]),_:2},1024)])]),_:2},1024))]),_:2},1024))),128))],64))]),_:1})]),_:1},8,["title"])]),_:1})]),_:1},8,["style"])]),_:1}),a(O,{visible:s(c).visible,"onUpdate:visible":o[1]||(o[1]=r=>s(c).visible=r),"mask-closable":!1,title:e.$t("nft.upgrade"),width:"370px","modal-class":"upgrade-modal","on-before-ok":le},{default:t(()=>[a($e,{title:e.$t("nft.consume"),column:1},{default:t(()=>[a(C,{label:e.$t("recharge.balance")},{default:t(()=>[b(u(s(c).balance),1)]),_:1},8,["label"]),a(C,{label:"ID"},{default:t(()=>[b(" # "+u(s(c).item.token),1)]),_:1}),a(C,{label:e.$t("nft.grade")},{default:t(()=>[b(u(s(c).item.grade)+" ",1),a(ke,{color:"green"},{icon:t(()=>[a(ye)]),default:t(()=>[mt]),_:1})]),_:1},8,["label"]),a(C,{label:e.$t("nft.roemp")},{default:t(()=>[a(x,null,{default:t(()=>[b(u(Z(s(c).item.grade))+" ",1),s(c).approve?j("",!0):(p(),h(B,{key:0,type:"primary",size:"small",onClick:ie},{default:t(()=>[b(u(e.$t("recharge.approve")),1)]),_:1}))]),_:1})]),_:1},8,["label"]),M(s(c).item.grade)>0?(p(),h(C,{key:0,label:e.$t("nft.NFT")},{default:t(()=>[a(x,null,{default:t(()=>[a(we,{modelValue:s(c).nfts,"onUpdate:modelValue":o[0]||(o[0]=r=>s(c).nfts=r),placeholder:`select ${M(s(c).item.grade)} nfs`,style:{width:"270px"},"value-key":"token",limit:M(s(c).item.grade),multiple:""},{label:t(({data:{value:r}})=>[k("span",null,u(r.name)+" #"+u(r.token),1)]),default:t(()=>[(p(!0),S(F,null,X(s(ee),r=>(p(),h(ve,{key:r.token,value:r},{default:t(()=>[b(u(r.name)+" #"+u(r.token),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue","placeholder","limit"])]),_:1})]),_:1},8,["label"])):j("",!0)]),_:1},8,["title"])]),_:1},8,["visible","title","on-before-ok"]),a(O,{visible:s(w).visible,"onUpdate:visible":o[3]||(o[3]=r=>s(w).visible=r),"align-center":!1,width:360,top:100,title:e.$t("nft.transfer"),"on-before-ok":de},{default:t(()=>[a(xe,{modelValue:s(w).address,"onUpdate:modelValue":o[2]||(o[2]=r=>s(w).address=r)},null,8,["modelValue"])]),_:1},8,["visible","title","on-before-ok"])])}}});var It=Ce(ut,[["__scopeId","data-v-35cea4ca"]]);export{It as default};
